<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<sect1 id="ch-system-udev" role="wrap">
<title>Udev-&udev-version;</title>
<?dbhtml filename="udev.html"?>

<indexterm zone="ch-system-udev"><primary sortas="a-Udev">Udev</primary></indexterm>

<sect2 role="package"><title/>
<para>The Udev package contains programs for dynamic creation of device nodes.</para>

<segmentedlist>
<segtitle>&buildtime;</segtitle>
<segtitle>&diskspace;</segtitle>
<seglistitem><seg>0.1 SBU</seg><seg>3.1 MB</seg></seglistitem>
</segmentedlist>

<segmentedlist>
<segtitle>&dependencies;</segtitle>
<seglistitem><seg>Coreutils and Make</seg></seglistitem>
</segmentedlist>

</sect2>

<sect2 role="installation">
<title>Installation of Udev</title>

<para>Create some devices that Udev cannot handle due to them being required
very early in the boot process:</para>

<screen><userinput>ln -sv /proc/self/fd /lib/udev/devices/fd 
ln -sv /proc/self/fd/0 /lib/udev/devices/stdin
ln -sv /proc/self/fd/1 /lib/udev/devices/stdout
ln -sv /proc/self/fd/2 /lib/udev/devices/stderr
ln -sv /proc/kcore /lib/udev/devices/core</userinput></screen>

<para>Compile the package:</para>

<screen><userinput>make \
EXTRAS="extras/ata_id extras/cdrom_id extras/edd_id extras/firmware extras/floppy extras/scsi_id extras/usb_id extras/volume_id"</userinput></screen>

<para>The meaning of the make option:</para>

<variablelist>
  <varlistentry>
    <term><parameter>EXTRAS=...</parameter></term>
    <listitem>
      <para>This builds several helper binaries that can aid in writing custom
      Udev rules.</para>
    </listitem>
  </varlistentry>
</variablelist>

<para>To test the results, issue:
<userinput>make test</userinput>.</para>

<para>Install the package:</para>

<screen><userinput>make DESTDIR=/ \
EXTRAS="extras/ata_id extras/cdrom_id extras/edd_id extras/firmware extras/floppy extras/scsi_id extras/usb_id extras/volume_id" \
install</userinput></screen>

<para>The meaning of the make option:</para>

<variablelist>
  <varlistentry>
    <term><parameter>DESTDIR=/</parameter>
    </term>
    <listitem>
      <para>This prevents the Udev build process from killing any
        <command>udevd</command> processes that may be running on the host
        system.
      </para>
    </listitem>
  </varlistentry>
</variablelist>

<para>Udev's configuration is far from ideal by default, so install
the configuration files here:</para>

<screen><userinput>cp -v ../&udev-config-file; /etc/udev/rules.d/25-lfs.rules</userinput></screen>

<para>Alter Udev's configuration file so that Udev can automatically load kernel
modules.</para>

<screen><userinput>sed -i 147,150d /etc/udev/rules.d/25-lfs.rules
cat &gt;&gt; /etc/udev/rules.d/25-lfs.rules &lt;&lt; EOF
# Rules to allow hotplugging of devices with modular drivers
ACTION=="add", SUBSYSTEM=="usb", MODALIAS=="*", \
   RUN+="/sbin/modprobe $modalias"
ACTION=="add", SUBSYSTEM=="scsi", SYSFS{type}=="[07]", \
   RUN+="/sbin/modprobe sd_mod"
EOF</userinput></screen> 

<para>Install the documentation that explains how to create Udev rules:</para>

<screen><userinput>install -m644 -D -v docs/writing_udev_rules/index.html /usr/share/doc/udev-&udev-version;/index.html</userinput></screen>

<!-- Not for the LiveCD -->
<!-- Edit Me -->

<para>Run the <command>udevstart</command> program to create our full
complement of device nodes.</para>

<screen><userinput>/sbin/udevstart</userinput></screen>

</sect2>

<sect2 id="contents-udev" role="content"><title>Contents of Udev</title>

<segmentedlist>
<segtitle>Installed programs</segtitle>
<segtitle>Installed directory</segtitle>
<seglistitem><seg>ata_id, cdrom_id, create_floppy_devices, edd_id,
firmware_helper, scsi_id, udevcontrol, udevd, udevinfo, udevmonitor, udevtest,
usb_id and vol_id</seg>
<seg>/etc/udev</seg></seglistitem>
</segmentedlist>

<variablelist><bridgehead renderas="sect3">Short Descriptions</bridgehead>
<?dbfo list-presentation="list"?>
<?dbhtml list-presentation="table"?>
                                                                                
<varlistentry id="ata_id">
  <term>
    <command>ata_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with a unique string and additional
    information (uuid, label) for an ATA drive</para>
    <indexterm zone="ch-system-udev ata_id">
      <primary sortas="b-ata_id">ata_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="cdrom_id">
  <term>
    <command>cdrom_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with the capabilities of a CD-ROM or
    DVD-ROM drive</para>
    <indexterm zone="ch-system-udev cdrom_id">
      <primary sortas="b-cdrom_id">cdrom_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="create_floppy_devices">
  <term>
    <command>create_floppy_devices</command>
  </term>
  <listitem>
    <para>Creates all possible floppy devices based on the CMOS type</para>
    <indexterm zone="ch-system-udev create_floppy_devices">
      <primary sortas="b-create_floppy_devices">create_floppy_devices</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="edd_id">
  <term>
    <command>edd_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with the EDD ID for a BIOS disk
    drive</para>
    <indexterm zone="ch-system-udev edd_id">
      <primary sortas="b-edd_id">edd_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="firmware_helper">
  <term>
    <command>firmware_helper</command>
  </term>
  <listitem>
    <para>Enables <command>udev</command> to upload firmware to devices</para>
    <indexterm zone="ch-system-udev firmware_helper">
      <primary sortas="b-firmware_helper">firmware_helper</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="scsi_id">
  <term>
    <command>scsi_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with a unique SCSI identifier based
    on the data returned from sending a SCSI INQUIRY command to the specified
    device</para>
    <indexterm zone="ch-system-udev scsi_id">
      <primary sortas="b-scsi_id">scsi_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="udevcontrol">
<term><command>udevcontrol</command></term>
<listitem>
<para>Configures a number of options for the running <command>udevd</command>
daemon, such as the log level.</para>
<indexterm zone="ch-system-udev udevcontrol"><primary sortas="b-udevcontrol">udevcontrol</primary>
</indexterm>
</listitem></varlistentry>

<varlistentry id="udevd">
<term><command>udevd</command></term>
<listitem>
<para>A daemon that reorders hotplug events before submitting them to
<command>udev</command>,
thus avoiding various race conditions</para>
<indexterm zone="ch-system-udev udevd"><primary sortas="b-udevd">udevd</primary></indexterm>
</listitem></varlistentry>

<varlistentry id="udevinfo">
<term><command>udevinfo</command></term>
<listitem>
<para>Allows users to query the <command>udev</command> database for
information on any device currently present on the system; it also
provides a way to query any device in the <systemitem
class="filesystem">sysfs</systemitem> tree to help create udev
rules</para>
<indexterm zone="ch-system-udev udevinfo"><primary sortas="b-udevinfo">udevinfo</primary></indexterm>
</listitem></varlistentry>

<varlistentry id="udevmonitor">
<term><command>udevmonitor</command></term>
<listitem>
<para>Prints the event received from the kernel and the event which
<command>udev</command> sends out after rule processing</para>
<indexterm zone="ch-system-udev udevmonitor"><primary sortas="b-udevmonitor">udevmonitor</primary>
</indexterm>
</listitem></varlistentry>

<varlistentry id="udevtest">
<term><command>udevtest</command></term>
<listitem>
<para>Simulates a <command>udev</command> run for the given device,
and prints out the name of the node the real <command>udev</command> would
have created or (not in LFS) the name of the renamed network interface</para>
<indexterm zone="ch-system-udev udevtest"><primary sortas="b-udevtest">udevtest</primary></indexterm>
</listitem></varlistentry>

<varlistentry id="usb_id">
  <term>
    <command>usb_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with information about USB devices
    </para>
    <indexterm zone="ch-system-udev usb_id">
      <primary sortas="b-usb_id">usb_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="vol_id">
  <term>
    <command>vol_id</command>
  </term>
  <listitem>
    <para>Provides <command>udev</command> with the label and uuid of a
    filesystem</para>
    <indexterm zone="ch-system-udev vol_id">
      <primary sortas="b-vol_id">vol_id</primary>
    </indexterm>
  </listitem>
</varlistentry>

<varlistentry id="etc-udev">
<term><filename class="directory">/etc/udev</filename></term>
<listitem>
<para>Contains <command>udev</command> configuation files,
device permissions, and rules for device naming</para>
<indexterm zone="ch-system-udev etc-udev"><primary sortas="e-/etc/udev">/etc/udev</primary></indexterm>
</listitem></varlistentry>
</variablelist>
</sect2>

</sect1>

