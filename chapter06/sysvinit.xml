<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<section xmlns="http://docbook.org/docbook-ng"
         xml:id="ch-system-sysvinit" xreflabel="Sysvinit" role="wrap">
<info><title>Sysvinit-&sysvinit-version;</title></info>
<?dbhtml filename="sysvinit.html"?>

<indexterm zone="ch-system-sysvinit"><primary sortas="a-Sysvinit">Sysvinit</primary></indexterm>

<section role="package"><info><title/></info>
<para>The Sysvinit package contains programs for controlling the startup,
running, and shutdown of your system.</para>

<segmentedlist>
<segtitle>&buildtime;</segtitle>
<segtitle>&diskspace;</segtitle>
<seglistitem><seg>0.1 SBU</seg><seg> 0.9 MB</seg></seglistitem>
</segmentedlist>

<segmentedlist>
<segtitle>Sysvinit installation depends on</segtitle>
<seglistitem><seg>Binutils, Coreutils, GCC, Glibc, Make</seg></seglistitem>
</segmentedlist>
</section>

<section role="installation">
<info><title>Installation of Sysvinit</title></info>

<para>Sysvinit &sysvinit-version; contains a <quote>buffer overflow</quote> bug.
Under some conditions, it clobbers the
values of environment variables. Fix that:</para>

<screen><userinput>patch -Np1 -i ../sysvinit-&sysvinit-version;-proclen-1.patch</userinput></screen>

<para>When run-levels are changed (for example, when halting the system),
<command>init</command> sends termination signals to those processes that
<command>init</command> itself started and that shouldn't be running in the new
run-level. While doing this, <command>init</command> outputs messages like
<quote>Sending processes the TERM signal</quote> which seem to imply that it is sending these signals to all currently running processes. To avoid this
misinterpretation, you can modify the source so that these messages read like
<quote>Sending processes started by init the TERM signal</quote> instead:</para>

<screen><userinput>sed -i 's@Sending processes@&amp; started by init@g' \
    src/init.c</userinput></screen>

<para>Compile Sysvinit:</para>

<screen><userinput>make -C src</userinput></screen>

<para>Then install it:</para>

<screen><userinput>make -C src install</userinput></screen>

</section>


<section xml:id="conf-sysvinit" role="configuration"><info><title>Configuring Sysvinit</title></info>
<indexterm zone="conf-sysvinit">
<primary sortas="a-Sysvinit">Sysvinit</primary>
<secondary>configuring</secondary></indexterm>

<indexterm zone="conf-sysvinit"><primary sortas="e-/etc/inittab">/etc/inittab</primary></indexterm>

<para>Create a new <filename>/etc/inittab</filename> file by running the
following:</para>

<screen><userinput>cat &gt; /etc/inittab &lt;&lt; "EOF"
# Begin /etc/inittab

id:3:initdefault:

si::sysinit:/etc/rc.d/init.d/rc sysinit

l0:0:wait:/etc/rc.d/init.d/rc 0
l1:S1:wait:/etc/rc.d/init.d/rc 1
l2:2:wait:/etc/rc.d/init.d/rc 2
l3:3:wait:/etc/rc.d/init.d/rc 3
l4:4:wait:/etc/rc.d/init.d/rc 4
l5:5:wait:/etc/rc.d/init.d/rc 5
l6:6:wait:/etc/rc.d/init.d/rc 6

ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -r now

su:S016:once:/sbin/sulogin

1:2345:respawn:/sbin/agetty -I '\033(K' tty1 9600
2:2345:respawn:/sbin/agetty -I '\033(K' tty2 9600
3:2345:respawn:/sbin/agetty -I '\033(K' tty3 9600
4:2345:respawn:/sbin/agetty -I '\033(K' tty4 9600
5:2345:respawn:/sbin/agetty -I '\033(K' tty5 9600
6:2345:respawn:/sbin/agetty -I '\033(K' tty6 9600

# End /etc/inittab
EOF</userinput></screen>

<para> The <parameter>-I '\033(K'</parameter> switch tells <command>agetty</command> to send this escape sequence to
the terminal before doing anything else. This escape sequence switches the
console character set to a user-defined one, which can be modified by
running the <command>setfont</command> program.
Actually, the <command>console</command> initscript from the LFS-Bootscripts
package calls the <command>setfont</command> program during system
startup. Sending this escape sequence is necessary for
people who use non-ISO-8859-1 screen font, but does not hurt native English
speakers.</para>

</section>


<section xml:id="contents-sysvinit" role="content"><info><title>Contents of Sysvinit</title></info>

<segmentedlist>
<segtitle>Installed programs</segtitle>
<seglistitem><seg>halt, init, killall5, last, lastb (link to last), mesg, pidof (link to 
killall5), poweroff (link to halt), reboot (link to halt), runlevel, shutdown, sulogin, telinit 
(link to init), utmpdump and wall</seg></seglistitem>
</segmentedlist>

<variablelist><title>Short descriptions</title>

<varlistentry xml:id="halt">
<term><command>halt</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit halt"><primary sortas="b-halt">halt</primary></indexterm>
<para>normally invokes <command>shutdown</command> with the <parameter>-h</parameter> flag,
except when already in run-level 0, then it tells the kernel to halt the system.
But first it notes in the file <filename>/var/log/wtmp</filename> that the
system is being brought down.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="init">
<term><command>init</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit init"><primary sortas="b-init">init</primary></indexterm>
<para>is the mother of all processes. It reads its
commands from <filename>/etc/inittab</filename>, which normally tell it which
scripts to run for which run-level, and how many gettys to spawn.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="killall5">
<term><command>killall5</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit killall5"><primary sortas="b-killall5">killall5</primary></indexterm>
<para>sends a signal to all processes, except the processes in its own session -- 
so it won't kill the shell running the script that called it.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="last">
<term><command>last</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit last"><primary sortas="b-last">last</primary></indexterm>
<para>shows which users last logged in (and out),
searching back through the file <filename>/var/log/wtmp</filename>. It can
also show system boots and shutdowns, and run-level changes.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="lastb">
<term><command>lastb</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit lastb"><primary sortas="b-lastb">lastb</primary></indexterm>
<para>shows the failed login attempts, as logged in 
<filename>/var/log/btmp</filename>.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="mesg">
<term><command>mesg</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit mesg"><primary sortas="b-mesg">mesg</primary></indexterm>
<para>controls whether other users can send
messages to the current user's terminal.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="pidof">
<term><command>pidof</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit pidof"><primary sortas="b-pidof">pidof</primary></indexterm>
<para>reports the PIDs of the given programs.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="poweroff">
<term><command>poweroff</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit poweroff"><primary sortas="b-poweroff">poweroff</primary></indexterm>
<para>tells the kernel to halt the system and
switch off the computer. But see <command>halt</command>.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="reboot">
<term><command>reboot</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit reboot"><primary sortas="b-reboot">reboot</primary></indexterm>
<para>tells the kernel to reboot the system. But see <command>halt</command>.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="runlevel">
<term><command>runlevel</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit runlevel"><primary sortas="b-runlevel">runlevel</primary></indexterm>
<para>reports the previous and the current run-level, as noted in the last run-level 
record in <filename>/var/run/utmp</filename>.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="shutdown">
<term><command>shutdown</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit shutdown"><primary sortas="b-shutdown">shutdown</primary></indexterm>
<para>brings the system down in a secure way,
signaling all processes and notifying all logged-in users.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="sulogin">
<term><command>sulogin</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit sulogin"><primary sortas="b-sulogin">sulogin</primary></indexterm>
<para>allows the superuser to log in. It is
normally invoked by <command>init</command> when the system goes into single user mode.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="telinit">
<term><command>telinit</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit telinit"><primary sortas="b-telinit">telinit</primary></indexterm>
<para>tells <command>init</command> which run-level to enter.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="utmpdump">
<term><command>utmpdump</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit utmpdump"><primary sortas="b-utmpdump">utmpdump</primary></indexterm>
<para>displays the content of the given login file in a friendlier format.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="wall">
<term><command>wall</command></term>
<listitem>
<indexterm zone="ch-system-sysvinit wall"><primary sortas="b-wall">wall</primary></indexterm>
<para>writes a message to all logged-in users.</para>
</listitem>
</varlistentry>
</variablelist>

</section>

</section>
