<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<section xmlns="http://docbook.org/docbook-ng"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xml:id="ch-system-gcc" xreflabel="GCC" role="wrap">
<title>GCC-&gcc-version;</title>
<?dbhtml filename="gcc.html"?>

<indexterm zone="ch-system-gcc"><primary sortas="a-GCC">GCC</primary></indexterm>

<section role="package"><title/>
<para>The GCC package contains the GNU compiler collection, which includes
the C and C++ compilers.</para>

<segmentedlist>
<segtitle>&buildtime;</segtitle>
<segtitle>&diskspace;</segtitle>
<seglistitem><seg>11.7 SBU</seg><seg>294 MB</seg></seglistitem>
</segmentedlist>

<segmentedlist>
<segtitle>GCC installation depends on</segtitle>
<seglistitem><seg>Bash, Binutils, Coreutils, Diffutils, Findutils,
Gawk, Gettext, Glibc, Grep, Make, Perl, Sed, Texinfo</seg></seglistitem>
</segmentedlist>
</section>

<section role="installation">
<title>Installation of GCC</title>

<para>This package is known to behave badly when you have changed its
default optimization flags (including the <parameter>-march</parameter> and <parameter>-mcpu</parameter> options).
Therefore, if you have defined any environment variables that override
default optimizations, such as CFLAGS and CXXFLAGS, we recommend un-setting
or modifying them when building GCC.</para>

<para>Unpack the GCC-core <emphasis>and</emphasis> the GCC-g++ tarball -- they
will unfold into the same directory. You should likewise extract the
GCC-testsuite package. The full GCC package contains even more
compilers. Instructions for building these can be found at
<link xlink:href="&blfs-root;view/stable/general/gcc.html"/>.</para>

<para>First apply only the No-Fixincludes patch (and <emphasis>not</emphasis>
the Specs patch) also used in the previous chapter:</para>

<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-no_fixincludes-1.patch</userinput></screen>

<para>GCC fails to compile some packages outside of a base Linux From Scratch
install (e.g., Mozilla and kdegraphics) when used in conjunction with newer
versions of binutils.  Apply the following patch to fix this issue:</para>

<screen><userinput>patch -Np1 -i ../gcc-&gcc-version;-linkonce-1.patch</userinput></screen>

<para>Now apply a sed substitution that will suppress the installation of
<filename class="libraryfile">libiberty.a</filename>. We want to use the version of
<filename class="libraryfile">libiberty.a</filename> provided by Binutils:</para>

<screen><userinput>sed -i 's/install_to_$(INSTALL_DEST) //' libiberty/Makefile.in</userinput></screen>

<para>The GCC documentation recommends building GCC outside of the source
directory in a dedicated build directory:</para>

<screen><userinput>mkdir ../gcc-build
cd ../gcc-build</userinput></screen>

<para>Now prepare GCC for compilation:</para>

<screen><userinput>../gcc-&gcc-version;/configure --prefix=/usr \
    --libexecdir=/usr/lib --enable-shared --enable-threads=posix \
    --enable-__cxa_atexit --enable-clocale=gnu --enable-languages=c,c++</userinput></screen>

<para>Compile the package:</para>

<screen><userinput>make</userinput></screen>

<important><para>The test suite for GCC in this section is considered
<emphasis>critical</emphasis>. Our advice is to not skip it under any
circumstance.</para></important>

<para>Test the results, but don't stop at errors (you'll remember the few
known ones):</para>

<screen><userinput>make -k check</userinput></screen>

<para>The test suite notes from <xref linkend="ch-tools-gcc-pass2"/> are still very
much appropriate here. Be sure to refer back there should you have any
doubts.</para>

<para>Now install the package:</para>

<screen><userinput>make install</userinput></screen>

<para>Some packages expect the C PreProcessor to be installed in the
<filename class="directory">/lib</filename> directory.
To support those packages, create this symlink:</para>

<screen><userinput>ln -s ../usr/bin/cpp /lib</userinput></screen>

<para>Many packages use the name <command>cc</command> to call the C
compiler. To satisfy those packages, create a symlink:</para>

<screen><userinput>ln -s gcc /usr/bin/cc</userinput></screen>

<note><para>At this point it is strongly recommended to repeat the sanity check
we performed earlier in this chapter. Refer back to
<xref linkend="ch-system-readjusting"/> and repeat the check. If the results
are wrong, then most likely you erroneously applied the GCC Specs patch from
<xref linkend="chapter-temporary-tools"/>.</para></note>

</section>


<section xml:id="contents-gcc" role="content"><title>Contents of GCC</title>

<segmentedlist>
<segtitle>Installed programs</segtitle>
<segtitle>Installed libraries</segtitle>
<seglistitem><seg>c++, cc (link to gcc),
cc1, cc1plus, collect2, cpp, g++, gcc, gccbug, and gcov</seg>
<seg>libgcc.a, libgcc_eh.a, libgcc_s.so, libstdc++.[a,so] and libsupc++.a</seg></seglistitem>
</segmentedlist>

<variablelist><title>Short descriptions</title>

<varlistentry xml:id="cpp">
<term><command>cpp</command></term>
<listitem>
<indexterm zone="ch-system-gcc cpp"><primary sortas="b-cpp">cpp</primary></indexterm>
<para>is the C preprocessor. It is used by the compiler to have the #include and 
#define and such statements expanded in the source files.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="g">
<term><command>g++</command></term>
<listitem>
<indexterm zone="ch-system-gcc g"><primary sortas="b-g++">g++</primary></indexterm>
<para>is the C++ compiler.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="gcc">
<term><command>gcc</command></term>
<listitem>
<indexterm zone="ch-system-gcc gcc"><primary sortas="b-gcc">gcc</primary></indexterm>
<para>is the C compiler. It is used to translate
the source code of a program into assembly code.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="gccbug">
<term><command>gccbug</command></term>
<listitem>
<indexterm zone="ch-system-gcc gccbug"><primary sortas="b-gccbug">gccbug</primary></indexterm>
<para>is a shell script used to help create good bug reports.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="gcov">
<term><command>gcov</command></term>
<listitem>
<indexterm zone="ch-system-gcc gcov"><primary sortas="b-gcov">gcov</primary></indexterm>
<para>is a coverage testing tool. It is used to
analyze programs to find out where optimizations will have the most effect.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="libgcc">
<term><filename class="libraryfile">libgcc*</filename></term>
<listitem>
<indexterm zone="ch-system-gcc libgcc"><primary sortas="c-libgcc*">libgcc*</primary></indexterm>
<para>contains run-time support for <command>gcc</command>.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="libstdc">
<term><filename class="libraryfile">libstdc++</filename></term>
<listitem>
<indexterm zone="ch-system-gcc libstdc"><primary sortas="c-libstdc++">libstdc++</primary></indexterm>
<para>is the standard C++ library. It contains many frequently-used functions.</para>
</listitem>
</varlistentry>

<varlistentry xml:id="libsupc">
<term><filename class="libraryfile">libsupc++</filename></term>
<listitem>
<indexterm zone="ch-system-gcc libsupc"><primary sortas="c-libsupc++">libsupc++</primary></indexterm>
<para>provides supporting routines for the c++ programming language.</para>
</listitem>
</varlistentry>
</variablelist>

</section>

</section>
