<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE section [
  <!ENTITY % general-entities SYSTEM "../general.ent">
  %general-entities;
]>
<section xmlns="http://docbook.org/docbook-ng"
         xml:id="ch-scripts-console">
<title>Configuring the Linux console</title>
<?dbhtml filename="console.html"?>

<indexterm zone="ch-scripts-console">
<primary sortas="d-console">console</primary>
<secondary>configuring</secondary></indexterm>

<para>In this section we will configure the <command>console</command>
initscript that sets up the keyboard
map and the console font. If you
don't need to use any non-ASCII characters
(British pound and Euro character are not ASCII),
and your keyboard is a US one, you can skip this section.
Without the configuration file,
the <command>console</command> initscript will do nothing.</para>

<para>The <command>console</command> script uses the
<filename>/etc/sysconfig/console</filename>
as a configuration file. You need to decide which keymap and screen font you
will use. The language-specific HOWTO can help you.
A pre-made
<filename>/etc/sysconfig/console</filename> file with known
good settings for several countries was installed with the LFS-Bootscripts
package, and you just have to uncomment
the relevant section if your country is supported (but read the rest
of this section anyway).
If still in doubt,
look into <filename class="directory">/usr/share/kbd</filename>
for valid keymaps and screen fonts. Then read the <command>loadkeys</command>
and <command>setfont</command> manual pages and figure out the correct
arguments for these programs.
Once you decided, create the
configuration file with the following command:</para>

<screen><userinput>cat &gt;/etc/sysconfig/console &lt;&lt;"EOF"
KEYMAP="<replaceable>[arguments for loadkeys]</replaceable>"
FONT="<replaceable>[arguments for setfont]</replaceable>"
EOF</userinput></screen>

<para>E.g., for Spanish users who also want to use the Euro character
(accessible by pressing AltGr+E),
the following settings are correct:</para>

<screen><userinput>cat &gt;/etc/sysconfig/console &lt;&lt;"EOF"
KEYMAP="es euro2"
FONT="lat9-16 -u iso01"
EOF</userinput></screen>

<note><para>The FONT line above is correct only for the ISO-8859-15
character set. If you prefer ISO-8859-1 and therefore use a pound sign
instead of Euro, the correct FONT line is:</para>

<screen><userinput>FONT="lat1-16"</userinput></screen></note>

<para>If the KEYMAP or FONT variable is not set, the
<command>console</command> initscript will not run the corresponding
program.</para>

<para>In some keymaps, the Backspace and Delete keys send characters
different form ones in the default keymap built into the kernel.
This confuses some applications, e.g., <application>Emacs</application>
displays its help (instead of erasing the character before the cursor)
when you press Backspace. To check if your keymap is affected (this works
only for i386 keymaps):</para>

<screen><userinput>zgrep '\W14\W' <replaceable>[/path/to/your/keymap]</replaceable></userinput></screen>

<para>If you see that keycode 14 is Backspace and not Delete,
create the following keymap snippet to fix this issue:</para>

<screen><userinput>mkdir -p /etc/kbd &amp;&amp; cat &gt;/etc/kbd/bs-sends-del &lt;&lt;"EOF"
                keycode 14 =    Delete  Delete          Delete  Delete
        alt     keycode 14 =    Meta_Delete
altgr   alt     keycode 14 =    Meta_Delete
                keycode 111 =   Remove
altgr   control keycode 111 =   Boot
control alt     keycode 111 =   Boot
altgr   control alt keycode 111 = Boot
EOF</userinput></screen>

<para>Then tell the <command>console</command> script to load this snippet
after the main keymap:</para>

<screen><userinput>cat &gt;&gt;/etc/sysconfig/console &lt;&lt;"EOF"
KEYMAP_CORRECTION="/etc/kbd/bs-sends-del"
EOF</userinput></screen>

<para>If you want to compile your keymap directly into the kernel instead of
setting it every time from the <command>console</command> bootscript, then
instructions are given in <xref linkend="ch-bootable-kernel"/>.  Doing this
ensures that your keyboard will always work as expected, even when you boot into
maintenance mode (by passing <parameter>init=/bin/sh</parameter> to the kernel),
as in that situation, the <command>console</command> bootscript won't be run.
Additionally, the kernel will not set the screen font automatically.  Again,
this shouldn't pose too many problems as ASCII characters will still be handled
correctly, and it is unlikely that you would need to rely on non-ASCII
characters whilst in maintenance mode.</para>

<para>Since the kernel will set up the keymap, you can omit the KEYMAP variable
from the <filename>/etc/sysconfig/console</filename> configuration file. If you
wish, you can still have it, this isn't going to hurt you. Keeping it could even
be beneficial, in case you run a lot of different kernels and can't be sure that
the keymap is compiled into every one of them.</para>

</section>
